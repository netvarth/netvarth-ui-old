<section class="card">
  <div class="title-gb no-padding">
    <div class="dash-head text-primary">
      <span class="fa fa-arrow-left pointer-cursor border-cirlce" (click)="goBack()"></span>&nbsp;
     {{headerName}}
    </div>
  </div>
</section>
<section class="container card mt-4 mx-auto" *ngIf="taskDetails">
  <app-common-innerloading-spinner *ngIf="api_loading"></app-common-innerloading-spinner>
  <div >
  <div stye="padding:10px">
    <div class="headerName">
      {{headerName}}
    </div>
    <hr  *ngIf="((this.taskDetails.title ==='Follow Up 1')  || (this.taskDetails.title ==='Follow Up 2')) && (taskDetails.customer) "/>
  </div>
  <!----task details start-->
  <div class="taskAndNote">
    <div class="formWidth">
      <div style="display: flex;
      align-items: center;
      gap: 10px;" *ngIf="((this.taskDetails.title ==='Follow Up 1')  || (this.taskDetails.title ==='Follow Up 2')) && (taskDetails.customer) ">
        <div class="imageClass">
          <div style="color: #8A8383;">{{firstCustomerName | capitalizeFirst}}</div>
        </div>
      <div>
        <div> 
          <div style="font-size: 14px;
          color: #000000;
          font-weight: bold;
          margin-bottom: 4px;">{{customerName | capitalizeFirst}}</div>
        </div>
        <div>
          <!-- <div style="font-size: 12px;color: #000000;" >{{customerPhNo}}</div> -->
          <div style="font-size: 12px;color: #000000;" >+91{{customerPhNo}}</div>
        </div>
      </div>
      </div>
    <hr />
    <form [formGroup]="taskDetailsForm">
      <div >
      <!---activityu name start-->
      <div class="formTop" *ngIf="bTaskTitle">
        <div class="taskTitle">
            <div class="inputlabel">Activity Name</div>
            <div class="astericColor">*</div>
        </div>
        <div>
          <div class="fieldPadding">
            <input (keyup)="resetErrors()" type="text" #taskTitle (ngModelChange)="oneField(taskTitle.value)"
                (ngModelChange)="handleTaskTitle(taskTitle.value,$event)" placeholder="Enter task title"
                class="form-control" formControlName="taskTitle" autocomplete="off"
                [value]="taskTitle" />
            <app-field-error-display [displayError]="true" style="color: #f24949 !important;"
                *ngIf="taskError" errorMsg="{{taskError}}">
            </app-field-error-display>
        </div>
        </div>
      </div>
      <!---activityu name start-->
      <!---description start-->
      <div class="formTop" *ngIf="bTaskDescription">
        <div class="taskTitle">
          <div>Description</div>
        </div>
      <div class="fieldPadding">
          <textarea rowa="10" class="form-control" formControlName="taskDescription" #taskDescription
              (ngModelChange)="handTaskDescription(taskDescription.value)"(keyup)="autoGrowTextZone($event)"
              maxlength="1000" placeholder="Enter task description" [value]="taskDescription" (ngModelChange)="oneField(taskDescription.value)">
      </textarea>
          <app-field-error-display [displayError]="true" style="color: #f24949 !important;"
              *ngIf="taskError" errorMsg="{{taskError}}">
          </app-field-error-display>
      </div>
      </div>
      <!----description end-->
      <!----area start-->
      <div class="formTop" *ngIf="bTaskAreaName">
        <div class="taskTitle">
            <div>Area</div>
        </div>
        <div class="fieldPadding">
            <input (keyup)="resetErrors()"[value]="areaName" #areaName (ngModelChange)="oneField(areaName.value)" (ngModelChange)="handeAreaName(areaName.value)" type="text"placeholder=""class="form-control" formControlName="areaName" autocomplete="off" placeholder="Enter area name" /> 
            <app-field-error-display [displayError]="true" style="color: #f24949 !important;" *ngIf="taskError" errorMsg="{{taskError}}">
            </app-field-error-display>    
        </div>
      </div>
      <!----area end-->
      <!---assignee start-->
      <div class="formTop" *ngIf="bAssigneeName">
        <div class="taskTitle">
            <div>Employee</div>
            <div class="astericColor">*</div>
        </div>
        <div class="fieldPadding">
            <div>
                <div formControlName="selectMember" class="form-control" style="display: flex;justify-content: space-between;" >
                    <div >{{selectMember}}</div>
                    <div style="cursor: pointer;" (ngModelChange)="oneField(selectMember)" (click)="selectMemberDialog(selectMember)" ><i  class="fa fa-user" aria-hidden="true"></i></div>
                </div>
            </div>
            <app-field-error-display [displayError]="true" style="color: #f24949 !important;" *ngIf="taskError" errorMsg="{{taskError}}">
            </app-field-error-display>  
        </div>                           
    </div>
      <!---assignee end-->
      <!----date start-->
      <div class="formTop"  *ngIf="(bTaskDate) ">
        <div class="taskTitle">
            <div>Due Date</div>
        </div>
        <div class="pickerouter fieldPadding dt dateWithMatDtae"  >
            <input formControlName="taskDate" class="form-control positionNameInput" type="text" matInput [matDatepicker]="picker" [min]="minDate" [max]="maxDate"
              [value]="ddate" (ngModelChange)="oneField(taskDate.value)" (dateChange)="handleDateChange($event)" placeholder="Enter Date" #taskDate>
            <mat-datepicker-toggle matSuffix [for]="picker">
              <!-- <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon> -->
            </mat-datepicker-toggle>
            <mat-datepicker #picker [dateClass]="dateClass.bind(this)">
            </mat-datepicker>
            <app-field-error-display [displayError]="true" style="color: #f24949 !important;" *ngIf="taskError" errorMsg="{{taskError}}">
            </app-field-error-display>       
        </div>
    </div>
      <!----date end-->
      <!---category start-->
      <div class="formTop" *ngIf="bTaskCategory">
        <div class="taskTitle">
            <div>Category</div>
            <div class="astericColor">*</div>
        </div>
        <div class="fieldPadding">
        <mat-select class="form-control " placeholder="Enter Category"
            #userTaskCategory formControlName="userTaskCategory" (ngModelChange)="oneField(userTaskCategory.value)" (selectionChange)="handleTaskCategorySelection(userTaskCategory.value)" >
            <mat-option *ngFor="let item of categoryListData[0];let index=i" [value]="item.id"  (ngModelChange)="handleTaskCategorySelection(userTaskCategory.value)" >
                <div>
                    {{item.name}}
                </div>
            </mat-option>
        </mat-select>
        </div>
        <!-- <div *ngIf="bErrormsgCategory" style="color: #f24949 !important;font-size: 12px;">{{errorMsgAnyCategory}}</div> -->
    </div>
      <!----category end-->
      <!----tasktype start-->
      <div class="formTop" *ngIf="bTaskType">
        <div class="taskTitle">
            <div>Type</div>
            <div class="astericColor">*</div>
        </div>
        <div class="fieldPadding">
        <mat-select class="form-control" placeholder="Enter Type"
            #userTaskType formControlName="userTaskType" (ngModelChange)="oneField(userTaskType.value)" (selectionChange)="handleTaskTypeSelection(userTaskType.value)">
            <mat-option *ngFor="let item of taskTypeList[0];let index=i" [value]="item.id"  (ngModelChange)="handleTaskTypeSelection(userTaskType.value)">
                <div>
                    {{item.name}}
                </div>
            </mat-option>
        </mat-select>
        </div>  
    </div>
      <!----task type end-->
      <!----location start-->
      <div class="formTop" *ngIf="bTaskLocation">
        <div class="taskTitle">
            <div>Location</div>
            <div class="astericColor">*</div>
        </div>
        <div class="fieldPadding">
            <input (keyup)="resetErrors()" (ngModelChange)="oneField(taskLocation.value)"  type="text" #taskLocation (ngModelChange)="handleTaskLocation(taskLocation.value)"
            placeholder="Enter activity location"class="form-control" formControlName="taskLocation" autocomplete="off" [value]="taskLocation.name" /> 
            <app-field-error-display [displayError]="true" style="color: #f24949 !important;" *ngIf="taskError" errorMsg="{{taskError}}">
            </app-field-error-display>    
        </div>
    </div>
      <!----location end-->
      <!----task manager start-->
      <div class="formTop" *ngIf="bTaskManager">
        <div class="taskTitle">
            <div>Manager</div>
        </div>
        <div class="fieldPadding">
            <div>
                <div (ngModelChange)="oneField(selectTaskManger)"  [formControlName]="selectTaskManger" class="form-control" style="display: flex;justify-content: space-between;"(click)="selectManagerDialog(selectTaskManger)" >
                    <div>{{selectTaskManger}}</div>
                    <div style="cursor: pointer;"  ><i class="fa fa-user" aria-hidden="true"></i></div>
                </div>
            </div>
            <app-field-error-display [displayError]="true" style="color: #f24949 !important;" *ngIf="taskError" errorMsg="{{taskError}}">
            </app-field-error-display>
        </div>                                     
    </div>
      <!---task manager end-->
      <!----est duration start-->
      <div class="formTop" *ngIf="bTaskEstDuration">
        <div class="taskTitle">
            <div>Est Duration</div>
        </div>
        <div class="fieldPadding d-flex" style="gap: 5px;flex-wrap: wrap;"  >
            <div class="estField">
                <div class="secondEst">
                    <input id="days" (ngModelChange)="oneField(taskDays.value)" [value]="taskDays" (keyup)="resetErrors()"  type="number" #taskDays (ngModelChange)="handleTaskEstDuration(taskDays.value)"
                placeholder="Days" class="form-control " formControlName="taskDays"   autocomplete="off" min="0"/>
                </div>
                <div class="timeField">Days</div>
            </div>
            <div class="estField">
                <div class="secondEst">
                    <input id="hrs" (ngModelChange)="oneField(taskHrs.value)" [value]="taskHrs" (keyup)="resetErrors()"  type="number" #taskHrs (ngModelChange)="handleTaskEstDuration(taskHrs.value)"
            placeholder="Hours" class="form-control " formControlName="taskHrs"   autocomplete="off" min="0" max="23"/>
                </div>
                <div class="timeField"> Hours </div>
            </div>
            <div class="estField">
                <div class="secondEst">
                    <input id="min" (ngModelChange)="oneField(taskMin.value)" [value]="taskMin" (keyup)="resetErrors()"  type="number" #taskMin (ngModelChange)="handleTaskEstDuration(taskMin.value)"
                    placeholder="Minutes" class="form-control" formControlName="taskMin"   autocomplete="off" min="0" max="59"/>
                </div>
                <div class="timeField">
                    Minutes 
                </div>
            </div>
            <app-field-error-display [displayError]="true" style="color: #f24949 !important;" *ngIf="taskError" errorMsg="{{taskError}}">
            </app-field-error-display>
        </div>
    </div>
      <!----est duration end-->
      <!---priority start-->
      <div class="formTop" *ngIf="bTaskPriority"> 
        <div class="taskTitle">
            <div>Priority</div>
        </div>
        <div class="fieldPadding">
            <mat-select class="form-control" placeholder="Select Priority"
                #userTaskPriority formControlName="userTaskPriority" (ngModelChange)="oneField(userTaskPriority.value)" (ngModelChange)="handleTaskPrioritySelection(userTaskPriority.value,'taskPriority')">
                <mat-option  *ngFor="let item of taskPriorityList[0];let index=i" [value]="item.id" >
                    <div>
                        {{item.name}}
                    </div>
                </mat-option>
            </mat-select>
        </div>
    </div>
      <!--priority end-->
      <!---status start-->
      <div class="formTop" *ngIf="bTaskStatus">
        <div class="taskTitle">
            <div>Status</div>
        </div>
        <div class="fieldPadding">
          <!-- [disabled]="!editable" -->
            <mat-select [disabled]="!editable"  class="form-control" placeholder="Enter activity status"
                #taskStatus formControlName="taskStatus" name="item" (ngModelChange)="oneField(taskStatus.value)"  (selectionChange)="handleTaskStatus(taskStatus.value)">
                <mat-option *ngFor="let item of taskStatusList[0];let index=i" [value]="item.id"  >
                    <!-- <div>
                        {{item.name | capitalizeFirst}}
                    </div> -->
                    <div [ngStyle]="{'color': getColor(item.name)}">
                        {{item.name | capitalizeFirst}}
                    </div>
                </mat-option>
            </mat-select>
            <app-field-error-display [displayError]="true" style="color: #f24949 !important;" *ngIf="taskError" errorMsg="{{taskError}}">
            </app-field-error-display>
        </div>
    </div>
      <!---status end-->
      <!---target potential start-->
      <div class="formTop" *ngIf="bTaskTargetPotential">
        <div class="taskTitle">
            <div>Target Potential</div>
        </div>
        <div class="fieldPadding">
            <input (keyup)="resetErrors()" type="text" (ngModelChange)="oneField(targetResult.value)" #targetResult (ngModelChange)="handleTargetResult(targetResult.value)"
            placeholder="Enter potential"class="form-control "formControlName="targetResult"  autocomplete="off" /> 
        </div>
    </div>
      <!---target potential end-->
      <!----business potential start-->
      <div class="formTop" *ngIf="bTaskBusinessPotential">
        <div class="taskTitle">
            <div>Business Potential</div>
        </div>
        <div class="fieldPadding" >
            <input #targetPotential min="0" (ngModelChange)="oneField(targetPotential.value)" (keyup)="resetErrors()" type="number"  (ngModelChange)="handleTargetPotential(targetPotential.value)" 
            placeholder="Enter ({{rupee_symbol}})"class="form-control "formControlName="targetPotential"autocomplete="off" />           
        </div>
    </div>
      <!---business potential end-->
      <div class="formTop">
        <div *ngIf="taskDetails.title ==='Follow Up 1' || taskDetails.title ==='Follow Up 2'" >
          <div class="card" style="border: 0.772915px solid #D9D5D5 !important;" >
            <div class="statusResult">
              <div style="font-size: 12px;font-weight: bold;">Enter Result</div>
            <div class="statusListClass">
              <div *ngFor="let item of taskStatusList[0]">
                <div *ngIf="item.name==='Proceed'" class="statusClass1" (click)="selectStatus(item)" id="A">
                  <div>{{item.name}}</div>
                  <div>
                    <img class="imageStatus" src="/assets/images/crmImages/completed2.png" />
                  </div>
                </div>
                <div *ngIf="item.name==='Pending'" class="statusClass2" (click)="selectStatus(item)" id="B">
                  <div>{{item.name}}</div>
                  <div>
                    <img class="imageStatus" src="/assets/images/crmImages/inProgress2.png" />
                  </div>
                </div>
                <div *ngIf="item.name==='Rejected'" class="statusClass3" (click)="selectStatus(item)" id="C">
                  <div>{{item.name}}</div>
                  <div>
                    <img class="imageStatus" src="/assets/images/crmImages/cancelled.png" />
                  </div>
                </div>
              </div>
            </div>
            </div>
          </div>
        </div>
      </div>
      
      <!----for web cancel save btn-->
      <div style="text-align: center;margin-top: 15px;" class="forWeb" *ngIf="bTaskFollowUpResult">
        <ng-container >
            <div class=" mgn-bt-20 mgn-up-10">
                <button type="button" class="btn btn-primary font-weight-bold cancelBtn" (click)="goBack()"
                    >Cancel
                </button>
                <button class="btn btn-primary font-weight-bold confirmBtn"
                  [class.spinner]="api_loading" 
                    [class.disabled]="api_loading" [class.spinner-center]="api_loading"  type="button"  (click)="saveCreateTask()">Save
                </button>
            </div>
        </ng-container>
    </div>
    <!------for web cancel & save btn -->
    </div>
    </form>
  </div>
  <!----\files start-->
  <div class="notesWidth">
    <div class="notesSection" *ngIf="!(this.taskDetails.title ==='Follow Up 1') && !(this.taskDetails.title ==='Follow Up 2') ">
      <div class="fiesWithIcon">
        <div>
          <span class="card-title"><b>Files</b></span> 
        </div>
        <div *ngIf="taskDetails.attachments.length>0">
          <span (click)="attatchmentDialog(taskDetails.attachments)" class="pointer-cursor fa fa-external-link"></span>
        </div>
      </div>
      <!-- <hr /> -->
      <div class="text-left" >
          <div class="filesUploadThings">
            <div *ngIf="taskType !=='SubTask'"  mat-button [mat-dialog-close]="true" class="lnk action pointer-cursor btn btn-primary upload-file-btn text-primary inputFile"  (click)="uploadFiles()">
              <div class="filesUploadThingsAction">
               <img width="25px" src="/assets/images/crmImages/fileUpload.png"  />
              <div class="text-dark btn-text">Click or Upload Files related to activity</div>
              </div>
            </div>
            <div *ngIf="taskType==='SubTask'" mat-button [mat-dialog-close]="true" class="lnk action pointer-cursor btn btn-primary upload-file-btn text-primary inputFile"  (click)="uploadFiles()">
              <div class="filesUploadThingsAction">
               <img width="25px" src="/assets/images/crmImages/fileUpload.png"  />
             <div class="text-dark btn-text">Click or Upload Files related to subactivity</div>
              </div>
            </div>
          </div>
          <!-- <span class="label" ><b></b></span> -->
          <div *ngIf="taskDetails.attachments.length>0" style="display: flex;align-items: center;margin-left: 10px;gap:5px" >
            <div>
              <img style="height:25px" src="/assets/images/crmImages/fileUploADHeader.png" />
            </div>
            <div class="label"style="padding:0px !important">
             ( Uploaded Files )
            </div>
          </div>
          <div class="my-2  height-limit" *ngIf="taskDetails.attachments.length>0">
            <div >
              <div *ngFor="let attachment of taskDetails.attachments;let i=index" class="allNotesList">
                <div class="notesListSection">
                  <div style="color: #121212;">{{attachment.originalName}}<br><span class="labelFile"><b>File Type : </b>{{attachment.type}} &nbsp;&nbsp;&nbsp;<b>Size : </b>{{attachment.size}} MB</span></div>
                  <a style="cursor: pointer;" href="{{attachment.s3path}}" target="_blank"><i class="fa fa-eye" aria-hidden="true"></i></a>
                </div>
               </div>
            </div>
          </div>
      </div>
    </div>
    <!---notes start-->
    <!-- *ngIf="!(this.taskDetails.title ==='Follow Up 1') && !(this.taskDetails.title ==='Follow Up 2') " -->
  <div style="margin-top:10px" >
    <div class="textareaStart">
      <div class="fiesWithIcon">
        <div>
          <span class="card-title"><b>Remarks</b></span> 
        </div>
        <div *ngIf="taskDetails.notes.length>0">
          <span (click)="noteView(taskDetails)" class="pointer-cursor fa fa-external-link"></span>
        </div>
      </div>
      <div style="padding:10px">
        <textarea  rows="10" class="form-control" [(ngModel)]="notesTextarea" #taskDescription
      (ngModelChange)="handleNotesDescription(taskDescription.value)" (keyup)="autoGrowTextZone($event)"
      maxlength="1000" placeholder="Enter remarks description" style=" height: 45px !important;background: #FCFCFC !important;border: 1.07315px solid #C9C9C9 !important;border-radius: 11.8046px !important;"></textarea>
      </div>
      <div *ngIf="errorMsg" class="errorMsg">
        <div>{{assignMemberErrorMsg}}</div>
    </div>
      <!---cancel save btn start-->
    <div style="display: flex;justify-content: flex-end;align-items: center;margin-right: 10px;margin-bottom: 10px;">
      <div style="text-align: center;">
          <ng-container>
              <div>
                  <button type="button" class="btn btn-primary font-weight-bold confirmBtn"
                      (click)="saveCreateNote(notesTextarea)">Add Remarks</button>
              </div>
          </ng-container>
      </div>
    </div>
  <!---cancel save btn end-->
  <!-- <app-common-innerloading-spinner *ngIf="api_loading"></app-common-innerloading-spinner> -->
  <!-- <span class="label" *ngIf="taskDetails.notes.length>0 "><b>Saved Remarks</b></span> -->
  <div *ngIf="taskDetails.notes.length>0 " style="display: flex;align-items: center;margin-left: 10px;" >
    <div>
      <img style="height:25px" src="/assets/images/crmImages/noteIcon.png" />
    </div>
    <div class="label"style="padding:0px !important">
     ( Saved Remarks)
    </div>
  </div>
          <div class="my-2  height-limit" *ngIf="taskDetails.notes.length>0 ">
            <!-- <app-common-innerloading-spinner *ngIf="api_loading"></app-common-innerloading-spinner> -->
            <div >
              <div *ngFor="let note of taskDetails.notes;let i=index" class="allNotesList" style="display: flex;justify-content: space-between;align-items: center;">
                <div class="notesListSection">
                  {{note.note}}
                </div>
                <div class="notesListSection">
                   <div>{{note.createdDate}}</div>
                </div>
               </div>
            </div>
          </div>
    </div>
  </div>
  <!---notes end-->
  <!----enter result start-->
  <div class="formTop" *ngIf="bActualResult && (!(this.taskDetails.title ==='Follow Up 1') && !(this.taskDetails.title ==='Follow Up 2'))">
    <div class="taskTitle">
        <div>No of data collected</div>
    </div>
    <div class="fieldPadding">
        <input min="0" (keyup)="resetErrors()" [(ngModel)]="actualResult" type="number"  #actualResultt (ngModelChange)="actualResultTask(actualResultt.value)"
        placeholder="No of data collected"class="form-control "   autocomplete="off" /> 
    </div>
</div>
  <!---enter result end-->
  </div>
  
  <!----files end-->
  </div>
  <!----task details end -->
  <!----for mobile cancel & save btn-->
  <div style="text-align: center;margin-top: 15px;" class="forMobile" *ngIf="bTaskFollowUpResult">
    <ng-container >
        <div class=" mgn-bt-20 mgn-up-10">
            <button type="button" class="btn btn-primary font-weight-bold cancelBtn" (click)="goBack()"
                >Cancel
            </button>
            <button class="btn btn-primary font-weight-bold confirmBtn"
              [class.spinner]="api_loading" 
                [class.disabled]="api_loading" [class.spinner-center]="api_loading"  type="button"  (click)="saveCreateTask()">Save
            </button>
        </div>
    </ng-container>
</div>
  <!----for mobile cancel & save btn-->
</div>
</section>