<section>
  <app-breadcrumb [breadcrumbs]="breadcrumbs"></app-breadcrumb>
</section>

<section>
  <div class="content comn-cls checkin-details">
    <div class="col-md-12 no-padding-small">
      <div class="row">
        <div class="lbl col-sm-12 col-md-8 col-lg-8 col-xl-8 no-padding-small">
          <div class="card" *ngIf="api_loading">
            <app-common-innerloading-spinner> </app-common-innerloading-spinner>
          </div>
          <div class="card" *ngIf="!api_loading">
            <div class="c-details">
              <div class="bk-ctrl">
                <span class="backtodashboard" (click)="gotoPrev()"><span class="strong">{{go_back_cap}}</span></span>
              </div>
              <!-- <button (click)="gotoPrev()">Back</button> -->
              <h2 *ngIf="!showToken">{{checkin_label | capitalizeFirst}} {{details_cap}}</h2>
              <h2 *ngIf="showToken">Token {{details_cap}}</h2>
              <div class="tp" *ngIf="waitlist_data">
                <div class="item"><span class="ttle">{{name_cap}}</span> <span>
                    {{waitlist_data.consumer.firstName | capitalizeFirst}}
                    {{waitlist_data.consumer.lastName | capitalizeFirst}}</span></div>
                <!-- <div class="item"><span class="ttle">Date:</span><span>{{waitlist_data.date | date:dateFormat}}</span></div> -->
                <div class="item">
                  <!-- <span class="ttle" *ngIf="checkTimedisplayAllowed(waitlist_data)">Date/Est Service time:</span> -->
                  <span class="ttle" *ngIf="checkTimedisplayAllowed(waitlist_data) && pdtype !== 2">{{getAppxTime(waitlist_data,
                    true)}}</span>
                  <span class="ttle" *ngIf="!checkTimedisplayAllowed(waitlist_data) || pdtype == 2">{{date_cap}}</span>
                  <span>
                    <!-- {{waitlist_data.date | date:dateFormatSp}} {{getAppxTime(waitlist_data)| date: timeFormat}} -->
                    {{waitlist_data.date | date:dateFormatSp}}
                    <!-- {{waitlist_data.date | date:dateFormatSp}}  --></span>

                  <!-- <span *ngIf="
                    getAppxTime(waitlist_data) !=-1">{{getAppxTime(waitlist_data)}}</span> -->
                </div>
                <div class="item otp_scr"
                  *ngIf="settings['calculationMode']!='NoCalc' && (waitlist_data.waitlistStatus == 'checkedIn' || waitlist_data.waitlistStatus == 'arrived') && (waitlist_data && !waitlist_data.appointmentTime)">
                  <span class="ttle" *ngIf="getAppxTime(waitlist_data) != -1 && pdtype==1">Est Wait
                    Time(minutes)</span>
                  <span class="ttle" *ngIf="getAppxTime(waitlist_data) != -1 && pdtype==2"> Est Service Time</span>
                  <span *ngIf="getAppxTime(waitlist_data) != -1 && !showEditView">
                    {{getAppxTime(waitlist_data)}}</span>
                  <span style="margin-left: 30px"
                    *ngIf="pdtype==1 && !showEditView && settings['calculationMode']=='Fixed'" class="editbt"
                    (click)="editClicked()"></span>
                  <div class="col-md-12 col-sm-12 col-lg-12 col-12 no-padding" *ngIf="showEditView">
                    <div class="input-group">
                      <input type="text" [(ngModel)]="esttime" id="estWatTme" max="500" maxlength="3"
                        (keyup)="isvalid($event)" (keypress)="isNumeric($event)"
                        class="form-control number-ip-sm col-md-8 col-sm-12 col-xs-12">
                      <span class="wait-btn">
                        <button class="cs-btn bt3 mgn-rt-5" style="margin-left: 5px;" (click)="cancelClicked()"
                          type="button">Cancel</button>
                        <button type="submit" class="cs-btn bt3" (click)="saveClicked(esttime)">Save</button>
                      </span>
                    </div>
                  </div>
                </div>
                <!-- <div class="item otp_scr" *ngIf="waitlist_data && waitlist_data.appointmentTime">
                  <span class="ttle"> Appointment Time</span>
                  <span *ngIf="!editAppntTime"> {{waitlist_data.appointmentTime}} </span>
                  <span *ngIf="!editAppntTime" style="margin-left: 30px" class="editbt" (click)="editApptTime()"></span>
                  <div class="col-md-12 col-sm-12 col-lg-12 col-12 no-padding" *ngIf="editAppntTime">
                    <div class="input-group">
                      <ngb-timepicker meridian="true" [(ngModel)]="apptTime" (ngModelChange)="changetime($event)">
                      </ngb-timepicker>
                      <span class="wait-btn">
                        <button class="cs-btn bt3 mgn-rt-5" style="margin-left: 5px;" (click)="cancelUpdation()"
                          type="button">Cancel</button>
                        <button type="submit" class="cs-btn bt3" (click)="saveApptTime()">Save</button>
                      </span>
                    </div>
                  </div>
                </div> -->
                <div class="item" *ngIf="waitlist_data.batchName"><span
                    class="ttle">Batch:</span><span>{{waitlist_data.batchName}}</span></div>
                <div class="item" *ngIf="waitlist_data.checkinEncId"><span class="ttle">Status
                    code</span><span>{{waitlist_data.checkinEncId}}</span></div>
                <div class="item"><span class="ttle">{{location_cap}}</span><span>{{waitlist_data.queue.location.place
                    | capitalizeFirst}}</span></div>
                <div class="item"><span class="ttle" *ngIf="!showToken">{{waitlist_for_cap}}</span>
                  <span class="ttle" *ngIf="showToken">Token for</span>
                  <span class="waitlist_for" *ngFor="let user of waitlist_data.waitlistingFor">
                    {{user.firstName | capitalizeFirst}} {{user.lastName | capitalizeFirst}}
                    <span
                      *ngIf="user.primaryMobileNo && user.primaryMobileNo.length === 10">({{user.primaryMobileNo}})</span>
                  </span>
                </div>
                <div class="item"><span class="ttle">{{service_cap}}</span><span> {{waitlist_data.service.name |
                    capitalizeFirst}}<span *ngIf="waitlist_data.service.deptName">
                      ({{waitlist_data.service.deptName}})</span></span></div>
                <div class="item"><span class="ttle">{{queue_cap}}</span>
                  <!-- <span> {{waitlist_data.queue.name |
                    capitalizeFirst}}</span> -->
                  {{waitlist_data.queue.queueStartTime}} - {{waitlist_data.queue.queueEndTime}}</div>
                <div class="item" *ngIf="pos"><span class="ttle">{{pay_status_cap}}</span>
                  <ng-container *ngIf="waitlist_data && waitlist_data.paymentStatus">
                    <span class="paid-n" *ngIf="waitlist_data.paymentStatus == 'NotPaid'"><span
                        class="text">{{not_paid_cap}}</span></span>
                    <span class="paid-h" *ngIf="waitlist_data.paymentStatus == 'PartiallyPaid'"><span
                        class="text">{{partially_paid_cap}}</span></span>
                    <span class="paid-f" *ngIf="waitlist_data.paymentStatus == 'FullyPaid'"><span
                        class="text">{{paid_cap}}</span></span>
                    <span class="paid-f" *ngIf="waitlist_data.paymentStatus == 'Refund'"><span
                        class="text">Refund</span></span>
                  </ng-container>
                </div>
                <div class="item" *ngIf="waitlist_data.waitlistPhoneNumber"><span
                    class="ttle">Phonenumber</span><span>{{waitlist_data.waitlistPhoneNumber}}</span></div>
                <div class="item" *ngIf="userDet['sector'] == 'foodJoints'"><span
                    class="ttle">{{party_size_cap}}</span><span>
                    {{waitlist_data.partySize}}</span></div>
              </div>
              <!-- <mat-accordion *ngIf="board_count > 0">
                <mat-expansion-panel [expanded]="false" class="statusboard-expansion">
                  <mat-expansion-panel-header class="no-padding mgn-bt-10">
                    <mat-panel-title class="block-level">
                      <span style="font-size: 1rem;"> {{optinal_fields}} </span>
                      <p class="form-level-settings">This field is only used for display.
                      </p>
                    </mat-panel-title>
                  </mat-expansion-panel-header> -->
              <div class="item otp_scr mgn-bt-20"
                *ngIf="(waitlist_data && waitlist_data.appointmentTime) || (availableSlots && availableSlots.length>0)">
                <div class="ttle mgn-bt-10"> Appointment Time</div>
                <span style="font-weight: 600;"
                  *ngIf="waitlist_data && waitlist_data.appointmentTime && !editAppntTime">
                  {{waitlist_data.appointmentTime}} </span>
                <span
                  *ngIf="waitlist_data && waitlist_data.appointmentTime && !editAppntTime && availableSlots && availableSlots.length>1 && (waitlist_data.waitlistStatus === 'arrived' || waitlist_data.waitlistStatus === 'checkedIn')"
                  style="margin-left: 30px" class="editbt" (click)="editApptTime()"></span>
                <div class="col-md-12 col-sm-12 col-lg-12 col-12 mgn-bt-20 no-padding ynw-common-form-nm"
                  *ngIf="editAppntTime || (waitlist_data && !waitlist_data.appointmentTime)">
                  <mat-chip-list class="check-in-chip">
                    <mat-chip *ngFor="let slot of availableSlots" [selected]="slot === waitlist_data.appointmentTime"
                      (click)="saveApptTime(slot)">{{slot}}</mat-chip>
                  </mat-chip-list>
                  <!-- <mat-form-field>
                          <mat-select placeholder="Appointment Time" [(ngModel)]="apptTime" #appttime>
                              <mat-option *ngFor="let slot of availableSlots" [value]="slot">
                                  {{slot}}
                              </mat-option>
                          </mat-select>
                          </mat-form-field> -->
                  <!-- <ngb-timepicker meridian="true" [(ngModel)]="appttime" (ngModelChange)="changetime($event)">
                        </ngb-timepicker> -->
                  <!-- <div class="wait-btn mgn-up-25">
                          <button class="cs-btn bt3 mgn-rt-5"
                            style="margin-left: 5px;" (click)="cancelUpdation()" type="button">Cancel</button>
                          <button type="submit" class="cs-btn bt3" (click)="saveApptTime()">Save</button>
                        </div> -->
                </div>
              </div>
              <div class="clearfix"></div>
              <!-- </mat-expansion-panel>
              </mat-accordion> -->
              <div class="item otp_scr mgn-bt-20" *ngIf="waitlist_data && waitlist_data.virtualService">
                <div class="ttle mgn-bt-10" style="font-weight: 500;
              font-size: 1rem;">Calling Modes</div>
                <div class="mgn-bt-5" *ngFor="let mode of waitlist_data.virtualService | keyvalue">
                  <span style="font-weight: 600;"> {{mode.key}}:
                    {{mode.value}} </span>
                </div>
              </div>
              <div class="clearfix"></div>
              <div class="btm" *ngIf="waitlist_data">
                <button class="cs-btn bt3 communicate" (click)="addConsumerInboxMessage()">{{send_msg_cap}}</button>
                <button class="cs-btn bt3 addprovider"
                  (click)="addProviderNote(waitlist_data)">{{add_pvt_note_cap}}</button>
                <button class="cs-btn bt7 cancel" (click)="changeWaitlistStatus()"
                  *ngIf="!waitlist_data.history &&
                                  ( waitlist_data.waitlistStatus == 'checkedIn' || waitlist_data.waitlistStatus == 'arrived')">{{cancel_cap}}
                  <span *ngIf="!showToken"> {{checkin_label |capitalizeFirst}} </span>
                  <span *ngIf="showToken"> Token </span> </button>
              </div>
            </div>
          </div>
          <div class="card p0">
            <mat-accordion class="communication-history">
              <mat-expansion-panel>
                <mat-expansion-panel-header>
                  <mat-panel-title>
                    {{communication_history_cap}}
                  </mat-panel-title>
                </mat-expansion-panel-header>
                <app-inbox-list [messages]="communication_history" [fromsource]="'provider_checkin_detail'"
                  (reloadApi)="getCommunicationHistory(waitlist_data.ynwUuid)"></app-inbox-list>
              </mat-expansion-panel>
            </mat-accordion>
          </div>
          <div class="card p0">
            <mat-accordion class="provider-notes">
              <mat-expansion-panel>
                <mat-expansion-panel-header>
                  <mat-panel-title>
                    <!-- {{provider_label |capitalizeFirst}} Notes -->
                    {{pvt_notes_cap}}
                  </mat-panel-title>
                </mat-expansion-panel-header>
                <div class="pnotes" *ngFor="let note of waitlist_notes">
                  <p [innerHTML]="note.note | nl2br"></p>
                  <p>{{note.timeStamp | date: dateTimeFormat}}</p>
                </div>
                <div *ngIf="waitlist_notes.length == 0">
                  <p>{{no_pvt_notes_cap}}</p>
                </div>
              </mat-expansion-panel>
            </mat-accordion>
          </div>
          <div class="card p0">
            <mat-accordion class="provider-notes">
              <mat-expansion-panel>
                <mat-expansion-panel-header>
                  <mat-panel-title>
                    <!-- {{provider_label |capitalizeFirst}} Notes -->
                    {{cust_notes_cap | capitalizeFirst}}
                  </mat-panel-title>
                </mat-expansion-panel-header>
                <div class="pnotes" *ngIf="waitlist_data && waitlist_data.consumerNote">
                  <p *ngIf="waitlist_data.consumerNote !== ''">{{waitlist_data.consumerNote}}</p>
                  <p *ngIf="waitlist_data.consumerNote === ''">{{no_cus_notes_cap}}</p>
                </div>
                <div *ngIf="waitlist_data && !waitlist_data.consumerNote">
                  <p>{{no_cus_notes_cap}}</p>
                </div>
              </mat-expansion-panel>
            </mat-accordion>
          </div>
        </div>
        <div class="lbr col-sm-12 col-md-4 col-lg-4 col-xl-4 no-padding-small">
          <div class="card">
            <h2 *ngIf="!showToken">{{checkin_label |capitalizeFirst}} History</h2>
            <h2 *ngIf="showToken">Token History</h2>
            <div class="c-history-outer">
              <ul class="c-history">
                <li class="{{history.waitlistStatus}}" *ngFor="let history of waitlist_history">
                  <div class="time">{{ history.time | date: dateTimeFormat }}</div>
                  <div class="action">{{check_in_statuses[history.waitlistStatus | capitalizeFirst]}}</div>
                </li>
              </ul>
              <p class="no-result" *ngIf="waitlist_history.length == 0">{{no_history_found}}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
<div class="clearfix"></div>

<!-- <section>
        <div class="content loc-list">
            <div class="col-md-12" *ngIf="waitlist_data">
              <div class="row">
                  <div class="card p0">
                      <div class="copy locd">
                              <div class="lbl col-sm-12 col-md-8 col-lg-8">
                                  <div class="cl1">

                                    <p>Name:
                                      {{waitlist_data.consumer.userProfile.firstName}} {{waitlist_data.consumer.userProfile.lastName}}
                                    </p>

                                    <p>Date:
                                      {{waitlist_data.date}}
                                    </p>

                                    <p>Location:
                                        {{waitlist_data.queue.location.place}}
                                    </p>

                                    <p>Service:
                                        {{waitlist_data.service.name}}
                                    </p>

                                    <p>Queue:
                                        {{waitlist_data.queue.name}}
                                    </p>

                                  </div>
                              </div>
                          </div>
                  </div>
              </div>
            </div>
            <p>Check In History</p>
            <div *ngFor="let history of waitlist_history">
              <span>Time: {{ history.time}}</span>
              <span>Status: {{ history.waitlistStatus}}</span>
            </div>
            <div *ngIf="waitlist_history.length == 0"> No history found</div>
            <mat-accordion>
              <mat-expansion-panel>
                <mat-expansion-panel-header>
                  <mat-panel-title>
                    Provider Notes
                  </mat-panel-title>
                </mat-expansion-panel-header>
                <div *ngFor="let note of waitlist_notes">
                  <p>Message: {{note.note}}</p>
                  <p>time: {{note.timeStamp | date: dateFormat}}</p>
                </div>
              </mat-expansion-panel>
            </mat-accordion>
              <button (click)="addProviderNote(waitlist_data)" >Add Provider note</button>
        </div>
    </section> -->