<section class="">
  <div class="card title-gb">
    <h5 class="mgn-up-10">
      <span class="fa fa-arrow-left pointer-cursor" (click)="gotoPrev()"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      Appointment
    </h5>
  </div>
</section>
<div class="content comn-cls checkin-details" *ngIf="waitlist_data">
  <div class="col-md-12 no-padding-small">
    <div class="row equal">
      <div class="lbl col-sm-12 col-md-4 col-lg-4 col-xl-4 no-padding-small px-1">
        <div class="rowcard card" *ngIf="api_loading">
          <app-common-innerloading-spinner> </app-common-innerloading-spinner>
        </div>
        <div class="rowcard card pt-0" *ngIf="!api_loading">
          <div class="c-details">
            <h2>
              <span style="float:right;font-size: 12px!important;margin-top: 17px!important;"
                class="customer-action-btn pointer-cursor my-auto" (click)="gotoActions(waitlist_data)">More
                Actions</span>
            </h2>
            <h2>
              <span class="fa-icons"><i *ngIf="waitlist_data.service.serviceType === 'virtualService'"
                  [class]="iconClass" class="fa-icons"></i></span>
              <span class="mt-1"><b>&nbsp;{{waitlist_data.service.name | capitalizeFirst}}</b></span>
              <div class="text-light">
                {{waitlist_data.appmtDate | date:newDateFormat}}<br>
                {{getSingleTime(waitlist_data.appmtTime)}}
              </div>
            </h2>
          </div>
          <span class="loc-cls">
            <div class="d-flex justify-content-between">
              <div *ngIf="waitlist_data.token">
                <span class="text-dark">Token No : {{waitlist_data.token}}</span>
              </div>
              <div *ngIf="waitlist_data.provider">
                <span class="text-dark">Assigned to {{waitlist_data.provider.businessName ?
                  waitlist_data.provider.businessName : waitlist_data.provider.firstName + ' ' +
                  waitlist_data.provider.lastName}}</span>
              </div>
            </div>
            <div class="d-flex justify-content-between">
              <div *ngIf="waitlist_data.service.deptName">
                <span class="text-dark">Department : {{waitlist_data.service.deptName}}</span>
              </div>
              <div *ngIf="waitlist_data.teamId !== 0">
                <span class="text-dark">Team : {{getUsersList(waitlist_data.teamId)}}</span>
              </div>
            </div>
            <i class="fa fa-map-marker"></i>&nbsp;{{waitlist_data.location.place | capitalizeFirst}}
          </span>
          <span class="text-light my-0 py-0"><b>Booking Via : </b>
            {{getAgent(waitlist_data.requestInfo.agent) | capitalizeFirst}},
            {{getBookingReqFrom(waitlist_data.requestInfo.browser,waitlist_data.requestInfo.bookingReqFrom) |
            capitalizeFirst}}</span>
          <span *ngIf="waitlist_data.appointmentMode" class="text-light"><b>Booking id :</b>
            {{waitlist_data.appointmentEncId}}</span>
          <span *ngIf="waitlist_data.appointmentMode" class="text-light"><b>Booking Mode :</b>
            {{getAppointmentMode(waitlist_data.appointmentMode)}}</span>
          <span *ngIf="label_length>0" class="text-light"><b>Labels :&nbsp;</b>
            <span *ngFor="let label of waitlist_data.label | keyvalue;let last = last">{{label.key}}
              <span *ngIf="!last">, </span>
            </span>
          </span>
          <div>
            <span *ngIf="waitlist_data.service.serviceType === 'virtualService'">
              <a *ngIf="check_in_statuses[waitlist_data.apptStatus | capitalizeFirst] != 'Started' && check_in_statuses[waitlist_data.apptStatus | capitalizeFirst] != 'Completed' && check_in_statuses[waitlist_data.apptStatus | capitalizeFirst] != 'Cancelled'"
                (click)="showCallingModes(waitlist_data.uid,'Started')"
                class="btn btn-success col-md-12 col-lg-12 col-xs-12 col-sm-12"><i class="fa fa-play"
                  aria-hidden="true"></i> Start</a>
            </span>
            <span *ngIf="waitlist_data.service.serviceType !== 'virtualService'">
              <a *ngIf="check_in_statuses[waitlist_data.apptStatus | capitalizeFirst] != 'Started' && check_in_statuses[waitlist_data.apptStatus | capitalizeFirst] != 'Completed' && check_in_statuses[waitlist_data.apptStatus | capitalizeFirst] != 'Cancelled'"
                (click)="changeWaitlistStatus('Started')"
                class="btn btn-success col-md-12 col-lg-12 col-xs-12 col-sm-12"><i class="fa fa-play"
                  aria-hidden="true"></i> Start</a>
            </span>
            <a (click)="changeStatus(waitlist_data)"
              *ngIf="check_in_statuses[waitlist_data.apptStatus | capitalizeFirst] == 'Started' && check_in_statuses[waitlist_data.apptStatus | capitalizeFirst] != 'Completed' && check_in_statuses[waitlist_data.apptStatus | capitalizeFirst] != 'Cancelled'"
              class="btn btn-success col-md-12 col-lg-12 col-xs-12 col-sm-12"><i class="fa fa-refresh"
                aria-hidden="true"></i> Change Status to</a>
            <a style="cursor: no-drop!important"
              *ngIf="check_in_statuses[waitlist_data.apptStatus | capitalizeFirst] != 'Started' && check_in_statuses[waitlist_data.apptStatus | capitalizeFirst] == 'Completed' && check_in_statuses[waitlist_data.apptStatus | capitalizeFirst] != 'Cancelled'"
              class="btn btn-info col-md-12 col-lg-12 col-xs-12 col-sm-12 my-2"><i class="fa fa-play"
                aria-hidden="true"></i> Completed</a>
            <a style="cursor: no-drop!important"
              *ngIf="check_in_statuses[waitlist_data.apptStatus | capitalizeFirst] != 'Started' && check_in_statuses[waitlist_data.apptStatus | capitalizeFirst] != 'Completed'  && check_in_statuses[waitlist_data.apptStatus | capitalizeFirst] == 'Cancelled'"
              class="btn btn-danger col-md-12 col-lg-12 col-xs-12 col-sm-12 my-2"><i class="fa fa-play"
                aria-hidden="true"></i> Cancelled</a>
          </div>
          <div class="text-center mx-auto">
            <a class="status-btn btn btn-outline-dark my" (click)="addConsumerInboxMessage()"><i
                class="fa fa-commenting-o" aria-hidden="true"></i> Message</a>
            <a class="status-btn btn btn-outline-dark my mx-1"
              *ngIf="check_in_statuses[waitlist_data.apptStatus | capitalizeFirst] === 'Started'"
              (click)="showCallingModes(waitlist_data.uid, 'STARTED')"> <span class="fa-icons"><i
                  *ngIf="waitlist_data.service.serviceType === 'virtualService'" [class]="iconClass"></i></span>
              Resume</a>
            <a class="status-btn btn btn-outline-dark my mx-1" *ngIf="check_in_statuses[waitlist_data.apptStatus | capitalizeFirst] != 'Started' && check_in_statuses[waitlist_data.apptStatus | capitalizeFirst] != 'Completed'
              && check_in_statuses[waitlist_data.apptStatus | capitalizeFirst] != 'Cancelled'"
              (click)="changeWaitlistStatus('Cancelled')"><i class="fa fa-times" aria-hidden="true"></i> Cancel</a>

            <a class="status-btn btn btn-disabled my mx-1" style="cursor: no-drop!important" *ngIf="check_in_statuses[waitlist_data.apptStatus | capitalizeFirst] == 'Started' || check_in_statuses[waitlist_data.apptStatus | capitalizeFirst] == 'Completed'
            || check_in_statuses[waitlist_data.apptStatus | capitalizeFirst] == 'Cancelled'">
              <i class="fa fa-times" aria-hidden="true"></i> Cancel</a>

            <a class="status-btn btn btn-disabled my mx-1"
              style="cursor: no-drop!important;margin-top: 0.1rem !important;margin-bottom: 0.1rem !important" *ngIf="check_in_statuses[waitlist_data.apptStatus | capitalizeFirst] != 'Started' || check_in_statuses[waitlist_data.apptStatus | capitalizeFirst] == 'Completed'
             || check_in_statuses[waitlist_data.apptStatus | capitalizeFirst] == 'Cancelled'">
              <i class="fa fa-check" aria-hidden="true"></i> Complete</a>

            <a class="status-btn btn btn-outline-dark my"
              style="margin-top: 0.1rem !important;margin-bottom: 0.1rem !important" *ngIf="check_in_statuses[waitlist_data.apptStatus | capitalizeFirst] == 'Started' && check_in_statuses[waitlist_data.apptStatus | capitalizeFirst] != 'Completed'
              && check_in_statuses[waitlist_data.apptStatus | capitalizeFirst] != 'Cancelled'"
              (click)="changeWaitlistStatus('Completed')"><i class="fa fa-check" aria-hidden="true"></i> Complete</a>
          </div>
        </div>
      </div>
      <div class="lbl col-lg-4 col-md-4 col-sm-12 col-xs-12 no-padding-small px-1">
        <div class="rowcard customer-details-card card">
          <div class="booking-details">
            <div class="row">
              <!-- <div *ngIf="waitlist_data.appmtFor" class="user-img float-left">
                <img src="assets/images/avatar5.png" />
              </div> -->
              <div class="user-img float-left"
                *ngIf="waitlist_data.appmtFor && waitlist_data.appmtFor[0].gender === 'male'">
                <img src="assets/images/mr_male.svg" />
              </div>
              <div class="user-img float-left"
                *ngIf="waitlist_data.appmtFor && waitlist_data.appmtFor[0].gender === 'female'">
                <img src="assets/images/mr_female.svg" />
              </div>
              <div class="user-img float-left"
                *ngIf="waitlist_data.appmtFor && waitlist_data.appmtFor[0].gender != 'male' && waitlist_data.appmtFor[0].gender != 'female'">
                <img src="assets/images/undefinedUser.png" />
              </div>
              <div class="float-right" *ngIf="waitlist_data.appmtFor && waitlist_data.appmtFor[0].id">
                <a (click)="editCustomerDetails()" style="font-size:13px!important;"
                  class="edit-btn pointer-cursor"><b>Edit Details</b></a>
              </div>
            </div>
            <span (click)="gotoCustomerDetails()" class="ml-0 pl-0 pointer-cursor"
              *ngIf="waitlist_data.appmtFor[0].firstName || waitlist_data.appmtFor[0].lastName">
              &nbsp;<b>{{waitlist_data.appmtFor[0].firstName | capitalizeFirst}} </b>
              <b class="">{{waitlist_data.appmtFor[0].lastName}}</b></span>
            <div class="booking-details-body">
              <div class="jaldee-id" *ngIf="waitlist_data.appointmentEncId">
                <i class="fa fa-id-card-o icon"
                  *ngIf="waitlist_data.appmtFor && waitlist_data.appmtFor[0].id"></i>&nbsp;
                <span class="itemHead" *ngIf="waitlist_data.appmtFor && waitlist_data.appmtFor[0].id">{{customer_label |
                  capitalizeFirst}} id : </span>
                <span class="itemVal">{{waitlist_data.appmtFor[0].memberJaldeeId}}</span>
              </div>
              <div class="contact-no" *ngIf="waitlist_data.phoneNumber && checkDataNull(waitlist_data.phoneNumber)">
                <i class="fa fa-mobile icon"></i>&nbsp;
                <span class="value">{{waitlist_data.countryCode}} {{waitlist_data.phoneNumber}}</span>
              </div>
              <div
                *ngIf="waitlist_data.service.serviceType === 'virtualService' && waitlist_data.service.virtualCallingModes[0].callingMode === 'WhatsApp'">
                <i class="fa fa-whatsapp icon"></i>&nbsp;
                <span
                  *ngIf=" waitlist_data.virtualService[waitlist_data.service.virtualCallingModes[0].callingMode].startsWith('+')">
                  {{ waitlist_data.virtualService[waitlist_data.service.virtualCallingModes[0].callingMode]}}</span>
                <span
                  *ngIf=" !waitlist_data.virtualService[waitlist_data.service.virtualCallingModes[0].callingMode].startsWith('+')">
                  +{{ waitlist_data.virtualService[waitlist_data.service.virtualCallingModes[0].callingMode]}}</span>
              </div>
              <div class="email" *ngIf="waitlist_data.appmtFor[0].email">
                <div class="float-left"><i class="fa fa-envelope"></i></div>
                <span class="emailvallabel">&nbsp;{{ waitlist_data.appmtFor[0].email}}</span>
              </div>
              <div class="gender-and-dob">
                <div class="dob" *ngIf="waitlist_data.appmtFor[0].dob">
                  <i class="fa fa-calendar-o icon"></i>
                  <span class="value">&nbsp;{{waitlist_data.appmtFor[0].dob | date:newDateFormat}}</span>
                </div>
              </div>
              <div class="location"
                *ngIf="waitlist_data.appmtFor && waitlist_data.appmtFor[0].bookingLocation && (waitlist_data.appmtFor[0].bookingLocation.district || waitlist_data.appmtFor[0].bookingLocation.state)">
                <i class="fa fa-map-marker icon"></i>
                <span class="value"> {{waitlist_data.appmtFor[0].bookingLocation.district}},
                  {{waitlist_data.appmtFor[0].bookingLocation.state}}</span>
              </div>
              <div class="mb-0">
                <a (click)="showCommunications()" *ngIf="whatsappNumber || mobileNumber || email"
                  class="btn btn-primary col-md-12 col-lg-12 col-xs-12 col-sm-12 my-2">Call {{customer_label |
                  capitalizeFirst}}</a>
              </div>
            </div>
          </div>
        </div>
      </div>



      <div class="col-xl-12 col-lg-4 col-md-4 col-sm-12 col-xs-12 no-padding-small px-1">
        <div class="card-custom data-card p-0 m-0">
          <app-history-section [source]="'appt'" [widget]="true" [waitlistdata]="waitlist_data" [spName]="spName"
            [waitlist_history]="waitlist_history" [internalStatuslog]="internalStatuslog"></app-history-section>
        </div>
        <div class="clearfix history-notes"></div>
        <div class="card-custom data-card p-0 m-0">
          <app-notes-section [source]="'customer'" [widget]="true" [waitlistdata]="waitlist_data"
            [waitlist_notes]="waitlist_notes">
          </app-notes-section>
        </div>
        <div class="card-custom data-card p-0 m-0" *ngIf="small_device_display">
          <app-notes-section [source]="'customerNote'" [widget]="true" [waitlistdata]="waitlist_data"
            [waitlist_notes]="waitlist_notes">
          </app-notes-section>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="clearfix"></div>
<section class="prov-apptDetail" *ngIf="waitlist_data">
  <div class="content comn-cls checkin-details no-padding" *ngIf="!small_device_display">
    <div class="lbl col-sm-12 col-md-8 col-lg-8 col-xl-8 no-padding-small mt-3">
      <div class="card" *ngIf="api_loading">
        <app-common-innerloading-spinner></app-common-innerloading-spinner>
      </div>
      <div class="card inboxList" *ngIf="!api_loading">
        <label>Messages</label>
        <app-inbox-list [messages]="communication_history" [fromsource]="'provider_checkin_detail'"
          (reloadApi)="getCommunicationHistory(waitlist_data.uid)">
        </app-inbox-list>
      </div>
    </div>
    <div class="lbl col-sm-12 col-md-4 col-lg-4 col-xl-4 no-padding-small mt-3" *ngIf="!small_device_display">
      <div class="card-custom data-card p-0 m-0">
        <app-notes-section [source]="'customerNote'" [widget]="true" [waitlistdata]="waitlist_data"
          [waitlist_notes]="waitlist_notes">
        </app-notes-section>
      </div>
    </div>
  </div>
</section>

<div>
  <div class="content checkin-details" *ngIf="waitlist_data">
    <div class="lbl col-sm-12 col-md-4 col-lg-4 col-xl-4 no-padding-small px-1"
      *ngIf="waitlist_data.appmtFor && (waitlist_data.providerAccount.serviceSector.domain === 'healthCare' || waitlist_data.providerAccount.serviceSector.domain === 'veterinaryPetcare') && waitlist_data.providerAccount.serviceSubSector.subDomain !=='laboratory' && waitlist_data.providerAccount.serviceSubSector.subDomain !=='pharmacy'">
      <app-booking-medical-records-rx [customerId]="waitlist_data.appmtFor[0].id" [source]="'customer-details'"
        [type]="'mr'">
      </app-booking-medical-records-rx>
    </div>
    <div class="lbl col-sm-12 col-md-4 col-lg-4 col-xl-4 no-padding-small px-1"
      *ngIf="waitlist_data.appmtFor && (waitlist_data.providerAccount.serviceSector.domain === 'healthCare' || waitlist_data.providerAccount.serviceSector.domain === 'veterinaryPetcare') && waitlist_data.providerAccount.serviceSubSector.subDomain !=='laboratory' && waitlist_data.providerAccount.serviceSubSector.subDomain !=='pharmacy'">
      <app-booking-medical-records-rx [customerId]="waitlist_data.appmtFor[0].id" [source]="'customer-details'"
        [type]="'rx'">
      </app-booking-medical-records-rx>
    </div>
    <div class="lbl col-lg-4 col-md-4 col-sm-12 col-xs-12 no-padding-small px-1"
      *ngIf="waitlist_data.appmtFor && waitlist_data.providerAccount.serviceSector.domain != 'finance'">
      <app-records-datagrid [heading]="'Bills'" [source]="'bill'" [records]="consumerBills"
        [customerId]="waitlist_data.appmtFor[0].id" [view]="'small'">
      </app-records-datagrid>
    </div>
  </div>

  <div class="clearfix"></div>
  <section class="prov-apptDetail" *ngIf="waitlist_data">
    <div class="content comn-cls checkin-details no-padding" *ngIf="small_device_display">
      <div class="lbl col-sm-12 col-md-8 col-lg-8 col-xl-8 no-padding-small mt-3">
        <div class="card" *ngIf="api_loading">
          <app-common-innerloading-spinner></app-common-innerloading-spinner>
        </div>
        <div class="card inboxList" *ngIf="!api_loading">
          <label>Messages</label>
          <app-inbox-list [messages]="communication_history" [fromsource]="'provider_checkin_detail'"
            (reloadApi)="getCommunicationHistory(waitlist_data.uid)">
          </app-inbox-list>
        </div>
      </div>
      <!-- <div class="lbl col-sm-12 col-md-4 col-lg-4 col-xl-4 no-padding-small mt-3" *ngIf="!small_device_display">
        <div class="card-custom data-card p-0 m-0">
          <app-notes-section [source]="'customerNote'" [widget]="true" [waitlistdata]="waitlist_data" [waitlist_notes]="waitlist_notes">
          </app-notes-section>
        </div>
      </div> -->
    </div>
  </section>

  <div class="content comn-cls checkin-details" *ngIf="!api_loading && questionnaires.length > 0">
    <div class="card-header text-capitalize card pointer-cursor d-flex" data-toggle="collapse" data-target="#moreinfo">
      <div>
        <span class="font-weight-bold grouping-heading float-left">{{customer_label | capitalizeFirst}} info</span>
        <span class="float-right arrow font-weight-bolder"><span class="fa fa-angle-down"></span></span>
      </div>
    </div>
  </div>

  <div class="collapse content checkin-details" id="moreinfo" *ngIf="!api_loading && questionnaires.length > 0">
    <div class="card">
      <div class="">
        <h3 class="">
          {{customer_label | capitalizeFirst}} info
        </h3>
      </div>
      <ng-container *ngIf="questionnaires.length > 1">
        <mat-accordion class="qnr-accord no-padding" *ngFor="let qnr of questionnaires">
          <mat-expansion-panel>
            <mat-expansion-panel-header>
              <mat-panel-title>
                {{(qnr.questionnaireName) ? qnr.questionnaireName : qnr.questionnaireId}}
                <div class="qnrstatus">
                  <span class="greenc" *ngIf="getQnrStatus(qnr) === 'submitted'">Submitted</span>
                  <span class="red" *ngIf="getQnrStatus(qnr) !== 'submitted'">Released</span>
                </div>
              </mat-panel-title>
            </mat-expansion-panel-header>
            <div class="c-details">
              <app-questionnaire [questionnaireList]="qnr" [source]="'proAppt'" [uuid]="waitlist_data.uid"
                [type]="'details'" [waitlistStatus]="waitlist_data.apptStatus"
                (returnAnswers)="getQuestionAnswers($event)">
              </app-questionnaire>
            </div>
          </mat-expansion-panel>
        </mat-accordion>
      </ng-container>
      <ng-container *ngIf="questionnaires.length === 1">
        <div class="c-details" *ngFor="let qnr of questionnaires">
          <app-questionnaire [questionnaireList]="qnr" [source]="'proAppt'" [uuid]="waitlist_data.uid"
            [type]="'details'" [waitlistStatus]="waitlist_data.apptStatus" (returnAnswers)="getQuestionAnswers($event)">
          </app-questionnaire>
        </div>
      </ng-container>
    </div>
  </div>
</div>
