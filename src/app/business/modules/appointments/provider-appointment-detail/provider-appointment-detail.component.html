<section>
  <app-breadcrumb [breadcrumbs]="breadcrumbs"></app-breadcrumb>
</section>
<section>
  <div class="content comn-cls checkin-details">
    <div class="col-md-12 no-padding-small">
      <div class="row">
        <div class="lbl col-sm-12 col-md-8 col-lg-8 col-xl-8 no-padding-small">
          <div class="card" *ngIf="api_loading">
            <app-common-innerloading-spinner> </app-common-innerloading-spinner>
          </div>
          <div class="card" *ngIf="!api_loading">
            <div class="c-details">
              <div class="bk-ctrl">
                <span class="backtodashboard" (click)="gotoPrev()"><span class="strong">{{go_back_cap}}</span></span>
              </div>
              <h2>{{checkin_label | capitalizeFirst}} {{details_cap}}</h2>
              <div class="tp" *ngIf="waitlist_data">
                <div class="item"><span class="ttle">{{name_cap}}</span>
                  <span>
                    {{waitlist_data.providerConsumer.firstName | capitalizeFirst}}
                    {{waitlist_data.providerConsumer.lastName | capitalizeFirst}}</span></div>
                <div class="item">
                  <span class="ttle" *ngIf="checkTimedisplayAllowed(waitlist_data) && pdtype !== 2">{{getAppxTime(waitlist_data,
                    true)}}:</span>
                  <span class="ttle" *ngIf="!checkTimedisplayAllowed(waitlist_data) || pdtype == 2">{{date_cap}}</span>
                  <span>
                    {{waitlist_data.appmtDate | date:dateFormatSp}}</span>
                </div>
                <div class="item otp_scr"
                  *ngIf="settings['calculationMode']!='NoCalc' && (waitlist_data.apptStatus == 'Confirmed' || waitlist_data.apptStatus == 'Arrived') && (waitlist_data && !waitlist_data.appmtTime)">
                  <span class="ttle" *ngIf="getAppxTime(waitlist_data) != -1 && pdtype==1"> Est Wait Time(minutes):</span>
                  <span class="ttle" *ngIf="getAppxTime(waitlist_data) != -1 && pdtype==2"> Est Service Time:</span>
                  <span *ngIf="getAppxTime(waitlist_data) != -1 && !showEditView">
                    {{getAppxTime(waitlist_data)}}</span> 
                  <span style="margin-left: 30px"
                    *ngIf="pdtype==1 && !showEditView && settings['calculationMode']=='Fixed'" class="editbt"
                    (click)="editClicked()"></span>
                  <div class="col-md-12 col-sm-12 col-lg-12 col-12 no-padding" *ngIf="showEditView">
                    <div class="input-group">
                      <input type="text" [(ngModel)]="esttime" id="estWatTme" max="500" maxlength="3"
                        (keyup)="isvalid($event)" (keypress)="isNumeric($event)"
                        class="form-control number-ip-sm col-md-8 col-sm-12 col-xs-12">
                      <span class="wait-btn">
                        <button class="cs-btn bt3 mgn-rt-5" style="margin-left: 5px;" (click)="cancelClicked()"
                          type="button">Cancel</button>
                        <button type="submit" class="cs-btn bt3" (click)="saveClicked(esttime)">Save</button>
                      </span>
                    </div>
                  </div>
                </div>
                <div class="item" *ngIf="waitlist_data.batchId"><span
                    class="ttle">Batch:</span><span>{{waitlist_data.batchId}}</span></div>
                <div class="item"><span class="ttle">{{location_cap}}</span>
                  <span *ngIf="waitlist_data.location">{{waitlist_data.location.place
                      | capitalizeFirst}}</span></div>
                <div class="item"><span class="ttle">{{waitlist_for_cap}}</span>
                  <span class="waitlist_for" *ngFor="let user of waitlist_data.appmtFor">
                    {{user.firstName | capitalizeFirst}} {{user.lastName | capitalizeFirst}}
                    <span
                      *ngIf="user.primaryMobileNo && user.primaryMobileNo.length === 10">({{user.primaryMobileNo}})</span>
                  </span>
                </div>
                <div class="item"><span class="ttle">{{service_cap}}</span><span> {{waitlist_data.service.name |
                    capitalizeFirst}}<span *ngIf="waitlist_data.service.deptName">
                      ({{waitlist_data.service.deptName}})</span></span></div>
                <div class="item"><span class="ttle">Schedule</span>
                  {{waitlist_data.schedule.apptSchedule.timeSlots[0].sTime}} -
                  {{waitlist_data.schedule.apptSchedule.timeSlots[0].eTime}}</div>
                <div class="item"><span class="ttle">{{pay_status_cap}}</span>
                  <ng-container *ngIf="waitlist_data && waitlist_data.paymentStatus">
                    <span class="paid-n" *ngIf="waitlist_data.paymentStatus == 'NotPaid'"><span
                        class="text">{{not_paid_cap}}</span></span>
                    <span class="paid-h" *ngIf="waitlist_data.paymentStatus == 'PartiallyPaid'"><span
                        class="text">{{partially_paid_cap}}</span></span>
                    <span class="paid-f" *ngIf="waitlist_data.paymentStatus == 'FullyPaid'"><span
                        class="text">{{paid_cap}}</span></span>
                    <span class="paid-f" *ngIf="waitlist_data.paymentStatus == 'Refund'"><span
                        class="text">Refund</span></span>
                  </ng-container>
                </div>
                <div class="item" *ngIf="userDet['sector'] == 'foodJoints' && waitlist_data.partySize"><span
                    class="ttle">{{party_size_cap}}</span><span>
                    {{waitlist_data.partySize}}</span></div>
              </div>
              <div class="item otp_scr mgn-bt-20" style="border-bottom: 1px solid #f2f2f2;"
                *ngIf="(waitlist_data && waitlist_data.appmtTime) || (availableSlotDetails && availableSlotDetails.length > 0)">
                <div class="ttle mgn-bt-10" style="font-weight: 500;
                font-size: 1rem;"> Appointment Time</div>
                <div class="mgn-bt-15" style="font-weight: 600;"
                  *ngIf="waitlist_data && waitlist_data.appmtTime && !editAppntTime">
                  {{getSingleTime(waitlist_data.appmtTime)}} </div>
                <!-- <span 
                  *ngIf="waitlist_data && waitlist_data.appmtTime && !editAppntTime && availableSlotDetails && availableSlotDetails.length>0 && (waitlist_data.apptStatus === 'Arrived' || waitlist_data.apptStatus === 'Confirmed')"
                  style="margin-left: 30px" class="editbt" (click)="editApptTime()"></span> -->
                <!-- <div class="col-md-12 col-sm-12 col-lg-12 col-12 mgn-bt-20 no-padding ynw-common-form-nm"
                  *ngIf="editAppntTime || (waitlist_data && !waitlist_data.appmtTime)">
                  <mat-chip-list class="check-in-chip">
                    <mat-chip *ngFor="let slot of availableSlotDetails"
                      [selected]="slot.time === waitlist_data.appmtTime" (click)="saveApptTime(slot.time)">{{slot.time}}
                    </mat-chip>
                  </mat-chip-list>
                </div> -->
              </div>
              <div class="clearfix"></div>
              <div class="item otp_scr mgn-bt-20" *ngIf="waitlist_data && waitlist_data.virtualService">
                <div class="ttle mgn-bt-10" style="font-weight: 500;
              font-size: 1rem;">Calling Modes</div>
                <div class="mgn-bt-5" *ngFor="let mode of waitlist_data.virtualService | keyvalue">
                  {{callingModes[mode.key]}}: <span style="font-weight: 600;">
                    {{mode.value}} </span></div>
              </div>
              <div class="clearfix"></div>
              <div class="btm" *ngIf="waitlist_data">
                <button class="cs-btn bt3 communicate" (click)="addConsumerInboxMessage()">{{send_msg_cap}}</button>
                <button class="cs-btn bt3 addprovider"
                  (click)="addProviderNote(waitlist_data)">{{add_pvt_note_cap}}</button>
                <button class="cs-btn bt7 cancel" (click)="changeWaitlistStatus()"
                  *ngIf="!waitlist_data.history &&
                                  ( waitlist_data.apptStatus == 'Confirmed' || waitlist_data.apptStatus == 'Arrived')">{{cancel_cap}}
                  {{checkin_label |capitalizeFirst}}</button>
              </div>
            </div>
          </div>
          <div class="card p0">
            <mat-accordion class="communication-history">
              <mat-expansion-panel>
                <mat-expansion-panel-header>
                  <mat-panel-title>
                    {{communication_history_cap}}
                  </mat-panel-title>
                </mat-expansion-panel-header>
                <app-inbox-list [messages]="communication_history" [fromsource]="'provider_checkin_detail'"
                  (reloadApi)="getCommunicationHistory(waitlist_data.uid)">
                </app-inbox-list>
              </mat-expansion-panel>
            </mat-accordion>
          </div>
          <div class="card p0">
            <mat-accordion class="provider-notes">
              <mat-expansion-panel>
                <mat-expansion-panel-header>
                  <mat-panel-title>
                    {{pvt_notes_cap}}
                  </mat-panel-title>
                </mat-expansion-panel-header>
                <div class="pnotes" *ngFor="let note of waitlist_notes">
                  <p [innerHTML]="note.note | nl2br"></p>
                  <p>{{note.timeStamp | date: dateTimeFormat}}</p>
                </div>
                <div *ngIf="waitlist_notes.length == 0">
                  <p>{{no_pvt_notes_cap}}</p>
                </div>
              </mat-expansion-panel>
            </mat-accordion>
          </div>
          <div class="card p0">
            <mat-accordion class="provider-notes">
              <mat-expansion-panel>
                <mat-expansion-panel-header>
                  <mat-panel-title>
                    {{cust_notes_cap | capitalizeFirst}}
                  </mat-panel-title>
                </mat-expansion-panel-header>
                <div class="pnotes" *ngIf="waitlist_data && waitlist_data.consumerNote">
                  <p *ngIf="waitlist_data.consumerNote !== ''">{{waitlist_data.consumerNote}}</p>
                  <p *ngIf="waitlist_data.consumerNote === ''">{{no_cus_notes_cap}}</p>
                </div>
                <div *ngIf="waitlist_data && !waitlist_data.consumerNote">
                  <p>{{no_cus_notes_cap}}</p>
                </div>
              </mat-expansion-panel>
            </mat-accordion>
          </div>
        </div>
        <div class="lbr col-sm-12 col-md-4 col-lg-4 col-xl-4 no-padding-small">
          <div class="card">
            <h2>{{checkin_label |capitalizeFirst}} History</h2>
            <div class="appthistory">
              <ul class="c-history">
                <li *ngFor="let history of waitlist_history" class="{{history.appointmentStatus}}">
                  <div class="time">{{history.date | date: dateFormat }} {{history.time}}</div>
                  <div class="action">{{check_in_statuses[history.appointmentStatus | capitalizeFirst]}}</div>
                </li>
              </ul>
              <p class="no-result" *ngIf="waitlist_history.length == 0">{{no_history_found}}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
<div class="clearfix"></div>