<section class="card">
  <div class="pointer-cursor">
    <div class="d-flex justify-content-between">
      <div class="d-flex align-items-center">
        <div> <i class="fa fa-arrow-left mr-2" aria-hidden="true" (click)="goBack()"></i></div>
        <div class="text-primary heading" class="back-btn" *ngIf="headerName">{{headerName |capitalizeFirst}}</div>
      </div>

      <div class="d-flex">
        <div *ngIf="filterConfig && filterConfig.length>0">
          <app-filter [position]="'right'" (filterEvent)="applyFilters($event)"
            [filterConfig]="filterConfig"></app-filter>
        </div>
      </div>
    </div>
  </div>
</section>


<section *ngIf="loading">
  <div>
    <app-skeleton-loading></app-skeleton-loading>
  </div>
</section>


<!-- <div *ngIf="!loading">
  <div class="card">
    <p-table [responsive]="true" responsiveLayout="scroll" #dt1 [value]="loans" dataKey="id" [rows]="10"
      [showCurrentPageReport]="true" [rowsPerPageOptions]="[10,25,50]" [loading]="loading"
      styleClass="p-datatable-customers p-datatable-gridlines" [paginator]="true"
      currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
      [globalFilterFields]="['referenceNo','customer.firstName','partner.partnerName','status']">
      <ng-template pTemplate="caption">
        <div class="row">
          <div class="col-md-4">
            <span>
              <input pInputText type="text" [style]="{'width':'100%'}" [inputStyle]="{'width':'100%'}"
                class="search-field" (input)="dt1.filterGlobal($event.target.value, 'contains')"
                placeholder="Search keyword" style="width:100%" />
            </span>
          </div>
          <div class="col-md-4"></div>
          <div class="col-md-4 text-right">
            <p-dropdown styleClass="text-left" [style]="{'width':'100%'}" [options]="loanStatus"
              (onChange)="statusChange($event)" [(ngModel)]="statusDisplayName" optionLabel="displayName"
              dataKey="name">
            </p-dropdown>
          </div>
        </div>
      </ng-template> 
      <ng-template pTemplate="header">
        <tr>
          <th>
            <div class="p-d-flex p-jc-between p-ai-center">
              Loan Id
              <p-columnFilter type="text" field="referenceNo" display="menu"></p-columnFilter>
            </div>
          </th>
          <th>
            <div class="p-d-flex p-jc-between p-ai-center">
              Customer Name
              <p-columnFilter type="text" field="customer.firstName" display="menu"></p-columnFilter>
            </div>
          </th>
          <th>
            <div class="p-d-flex p-jc-between p-ai-center">
              Dealer
              <p-columnFilter type="text" field="partner.partnerName" display="menu"></p-columnFilter>
            </div>
          </th>
          <th>
            <div class="p-d-flex p-jc-between p-ai-center">
              Status
            </div>
          </th>
          <th>
            <div class="p-d-flex p-jc-between p-ai-center">
              More Actions
            </div>
          </th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-loan>
        <tr class="mobile-card">
          <td>
            <span class="d-lg-none d-md-none">Loan Application No : </span><span
              class="table-column-data">{{loan.referenceNo}}</span>
          </td>
          <td>
            <span class="d-lg-none d-md-none">Customer Name : </span><span
              class="table-column-data">{{loan.customer.firstName}}
              {{loan.customer.lastName}}</span>
          </td>
          <td>
            <span class="d-lg-none d-md-none d-sm-block">Dealer : </span><span class="table-column-data"
              *ngIf="loan && loan.partner && loan.partner.partnerName">{{loan.partner.partnerName}}</span>
            <span class="table-column-data" *ngIf="loan && !loan.partner || !loan.partner.partnerName">-</span>
          </td>
          <td>
            <span class="d-lg-none d-md-none">Status : </span>
            <span *ngIf="loan.applicationStatus !='Rejected'" [class]="'customer-badge status-' + loan.spInternalStatus"
              class="table-column-data">
              {{loan.spInternalStatusDisplyName}}</span>
            <span *ngIf="loan.applicationStatus =='Rejected'"
              [class]="'customer-badge status-' + loan.applicationStatus" class="table-column-data">
              {{loan.applicationStatus}}</span>
          </td>
          <td>
            <div class="text-center">
              <div class="d-flex">
                <button *ngIf="loan.spInternalStatus=='Draft'" pButton pRipple type="button"
                  class="p-button-primary mr-2" (click)="updateLoan(loan.uid, 'update', 'Draft')">Update</button>
                <button pButton pRipple type="button" class="p-button-primary"
                  (click)="loanDetails(loan.uid,loan.spInternalStatus)">View</button>
              </div>
            </div>
          </td>
        </tr>
        <br class="d-lg-none d-md-none">
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="7">No Loans found.</td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div> -->
<div *ngIf="!loading">
  <div class="card">
    <p-table [columns]="selectedColumns" #loansTable [value]="loans" [lazy]="true" (onLazyLoad)="loadLoans($event)"
      dataKey="id" [showCurrentPageReport]="true" [rowsPerPageOptions]="[10,25,50]" [paginator]="true" [rows]="10"
      [totalRecords]="totalLoansCount" [loading]="loading" responsiveLayout="stack" scrollHeight="flex"
      [globalFilterFields]="['referenceNo','customer.firstName','partner.partnerName','status']"
      styleClass="p-datatable-customers p-datatable-gridlines"
      currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries">
      <ng-template pTemplate="caption">
        <div class="row">
          <div class="col-md-4 no-padding-small">
            <!-- <span class="p-input-icon-right" [style]="{'width':'100%'}">
              <i class="pi pi-search pointer-cursor" (click)="loanGlobalSearch(globalSearchValue)"></i>
              <input pInputText type="text" [style]="{'width':'100%'}" [inputStyle]="{'width':'100%'}"
                class="search-field" [(ngModel)]="globalSearchValue" placeholder="Search Loans" style="width:100%" />
            </span> -->
          </div>
          <div class="col-md-4 no-padding-small">
            <div class="full-width">
              <p-multiSelect [options]="cols" [(ngModel)]="selectedColumns" optionLabel="title"
                selectedItemsLabel="{0} columns selected" [style]="{'min-width': '200px','width': '100%'}"
                placeholder="Choose Columns"></p-multiSelect>
            </div>
          </div>
          <div class="col-md-4 no-padding-small text-right">
            <p-dropdown styleClass="text-left" [style]="{'width':'100%'}" [options]="loanStatus"
              (onChange)="statusChange($event)" [(ngModel)]="statusDisplayName" optionLabel="displayName"
              dataKey="name">
            </p-dropdown>
          </div>
        </div>
      </ng-template>
      <ng-template pTemplate="header" let-columns>
        <tr>
          <th pSortableColumn="referenceNo">Loan Id <p-sortIcon field="referenceNo"></p-sortIcon></th>
          <th *ngFor="let col of columns" pSortableColumn="{{col.field}}">{{col.title}} <p-sortIcon
              field="{{col.field}}"></p-sortIcon></th>
          <th>More Actions</th>
        </tr>

        <tr>
          <th>
            <p-columnFilter type="text" field="referenceNo"></p-columnFilter>
          </th>
          <th *ngFor="let col of columns">
            <p-columnFilter type="{{col.type}}" field="{{col.field}}"></p-columnFilter>
          </th>
          <th></th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-loan let-columns="columns">
        <tr class="mobile-card">
          <td>
            <span class="d-lg-none d-md-none">Loan Application No : </span><span
              class="table-column-data">{{loan.referenceNo}}</span>
          </td>
          <td *ngIf="showColumn('customerFirstName') && selectedColumns">
            <span class="d-lg-none d-md-none">Customer Name : </span><span
              class="table-column-data">{{loan.customer.firstName}}
              {{loan.customer.lastName}}</span>
          </td>
          <td *ngIf="showColumn('partnerName') && selectedColumns">
            <span class="d-lg-none d-md-none d-sm-block">Dealer : </span><span class="table-column-data"
              *ngIf="loan && loan.partner && loan.partner.partnerName">{{loan.partner.partnerName}}</span>
            <span class="table-column-data" *ngIf="loan && !loan.partner || !loan.partner.partnerName">-</span>
          </td>
          <td *ngIf="showColumn('createdDate') && selectedColumns">
            <span class="d-lg-none d-md-none d-sm-block">created Date : </span><span class="table-column-data"
              *ngIf="loan && loan.createdDate">{{loan.createdDate | date:'longDate'}}</span>
            <span class="table-column-data" *ngIf="loan && !loan.createdDate">-</span>
          </td>
          <td *ngIf="showColumn('spInternalStatus') && selectedColumns">
            <span class="d-lg-none d-md-none">Status : </span>
            <span *ngIf="loan.applicationStatus !='Rejected'" [class]="'customer-badge status-' + loan.spInternalStatus"
              class="table-column-data">
              {{loan.spInternalStatusDisplyName}}</span>
            <span *ngIf="loan.applicationStatus =='Rejected'"
              [class]="'customer-badge status-' + loan.applicationStatus" class="table-column-data">
              {{loan.applicationStatus}}</span>
          </td>
          <td>
            <div class="text-center">
              <div class="d-flex">
                <button *ngIf="loan.spInternalStatus=='Draft' || loan.isActionRequired" pButton pRipple type="button"
                  class="p-button-primary mr-2" (click)="updateLoan(loan.uid, 'update', 'Draft')">Update</button>
                <button pButton pRipple type="button" class="p-button-primary"
                  (click)="loanDetails(loan.uid,loan.spInternalStatus)">View</button>
              </div>
            </div>
          </td>
        </tr>
        <br class="d-lg-none d-md-none">
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="7">No Loans found.</td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>